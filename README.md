# ä¼æ¥­IRèª¿æŸ»ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ä¼æ¥­IRã‚µã‚¤ãƒˆã‚’è‡ªå‹•èª¿æŸ»ã—ã€CSVå½¢å¼ã§çµæœã‚’å‡ºåŠ›ã™ã‚‹ Node.js ãƒ™ãƒ¼ã‚¹ã® CLI ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚`src/index.js` ã‹ã‚‰å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰ã‚’åˆ‡ã‚Šæ›¿ãˆã¦åˆ©ç”¨ã—ã¾ã™ã€‚

## å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰

| ãƒ¢ãƒ¼ãƒ‰              | èª¿æŸ»ç¯„å›²                                | æƒ³å®šç”¨é€”                   | å‚™è€ƒ                                                        |
| ------------------- | --------------------------------------- | -------------------------- | ----------------------------------------------------------- |
| `full` (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ) | 8é …ç›®ï¼ˆã‚µã‚¤ãƒˆå†…æ¤œç´¢ã€œã‚µã‚¹ãƒ†ãƒŠãƒ“ãƒªãƒ†ã‚£ï¼‰ | è©³ç´°èª¿æŸ»ã€ç´å“ç”¨ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ | 404ãƒã‚§ãƒƒã‚¯ãƒ»ãƒªãƒ³ã‚¯å…ˆæ¤œè¨¼ã‚’å®Ÿæ–½                             |
| `primary`           | é …ç›®1-2ï¼ˆã‚µã‚¤ãƒˆå†…æ¤œç´¢ / è‹±èªç‰ˆï¼‰        | ä¸€æ¬¡äºˆé¸ã‚„å¤§é‡èª¿æŸ»         | Detailedå½¢å¼ã§å‡ºåŠ›                                          |
| `secondary`         | é …ç›®3-8                                 | äºŒæ¬¡äºˆé¸ãƒ»è¿½åŠ èª¿æŸ»         | Detailedå½¢å¼ã§å‡ºåŠ›                                          |
| `compact`           | é …ç›®1-2                                 | Basicç‰ˆç›¸å½“ã‚µãƒãƒªãƒ¼        | Compactå½¢å¼ã§å‡ºåŠ› |

`compact` ãƒ¢ãƒ¼ãƒ‰ã¯ 1ã‚µã‚¤ãƒˆ4-5ç§’ç¨‹åº¦ã€`full` ãƒ¢ãƒ¼ãƒ‰ã¯ 1ã‚µã‚¤ãƒˆ30-40ç§’ç¨‹åº¦ã‚’ç›®å®‰ã¨ã—ã¦ãã ã•ã„ã€‚

## å®Ÿè¡Œæº–å‚™ï¼ˆå…±é€šï¼‰

1. **Node.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**  
   [Node.js å…¬å¼ã‚µã‚¤ãƒˆ](https://nodejs.org/) ã‹ã‚‰æ¨å¥¨ LTS ç‰ˆï¼ˆ18 ä»¥ä¸Šï¼‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ»ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’é€²ã‚ã‚‹ã ã‘ã§ `npm` ã‚‚è‡ªå‹•ã§å°å…¥ã•ã‚Œã¾ã™ã€‚
2. **ãƒªãƒã‚¸ãƒˆãƒªã®é…ç½®**  
   ZIP ã‚’å±•é–‹ã™ã‚‹ã‹ Git ã§è¤‡è£½ã—ã€ä»»æ„ã®å ´æ‰€ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ç½®ãã¾ã™ã€‚ãƒ•ã‚©ãƒ«ãƒ€åã¯ä¾‹ã¨ã—ã¦ `ir-ranking-screening` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚
3. **ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªï¼ˆå¿…é ˆï¼‰**  
   `config/keywords.json` ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚å‰Šé™¤ãƒ»æ”¹åã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å®Ÿè¡Œã§ãã¾ã›ã‚“ã€‚æ¡ˆä»¶ã”ã¨ã®èª¿æ•´ã‚‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«é›†ç´„ã—ã¾ã™ã€‚
4. **å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª**  
   `input/` ãƒ•ã‚©ãƒ«ãƒ€ã«èª¿æŸ»å¯¾è±¡ URL ãƒªã‚¹ãƒˆã‚’å…¥ã‚Œã¾ã™ã€‚æœ€åˆã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ« (`urls_sample.json` / `urls_sample.txt`) ãŒåŒæ¢±ã•ã‚Œã¦ã„ã¾ã™ã€‚

## macOS / Linux ã§ã®å®Ÿè¡Œæ‰‹é †

1. **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã**  
   Finder ã§ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ãã€å³ã‚¯ãƒªãƒƒã‚¯ â†’ã€Œã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§é–‹ãã€ã‚„ `cd` ã‚³ãƒãƒ³ãƒ‰ã§ç§»å‹•ã—ã¾ã™ã€‚
   ```bash
   cd /path/to/ir-ranking-screening
   ```
2. **åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**  
   ```bash
   npm install
   ```
   ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚å®Œäº†ã¾ã§æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
3. **ã‚µãƒ³ãƒ—ãƒ«ã§å‹•ä½œç¢ºèª**  
   ```bash
   npm run survey:sample
   ```
   å®Ÿè¡Œå¾Œã«ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
   - `output/` ã« `YYYYMMDDHHMMSS_IRèª¿æŸ»çµæœ_...csv` ãŒç”Ÿæˆã•ã‚Œã‚‹
   - `logs/` ã« `YYYYMMDDHHMMSS_ir-survey.log` ãŒç”Ÿæˆã•ã‚Œã‚‹
4. **è‡ªåˆ†ã®ãƒªã‚¹ãƒˆã§å®Ÿè¡Œ**  
   `input/` ã«ã‚³ãƒ”ãƒ¼ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã—ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
   ```bash
   node src/index.js --mode full --file your_file.json
   ```
   `--mode` ã‚’ `primary` ã‚„ `secondary` ã«å¤‰æ›´ã™ã‚‹ã¨å¯¾è±¡é …ç›®ã‚’çµã‚Œã¾ã™ã€‚

## Windows ã§ã®å®Ÿè¡Œæ‰‹é †

1. **Node.js ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**  
   [ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸](https://nodejs.org/) ã‹ã‚‰ Windows ç”¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ã‚’å–å¾—ã—ã€ç”»é¢ã®æŒ‡ç¤ºã«å¾“ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
2. **PowerShell / Windows Terminal ã‚’é–‹ã**  
   ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã€ŒPowerShellã€ã¾ãŸã¯ã€ŒWindows Terminalã€ã‚’æ¤œç´¢ã—ã¦èµ·å‹•ã—ã€ãƒ•ã‚©ãƒ«ãƒ€ã¸ç§»å‹•ã—ã¾ã™ã€‚
   ```powershell
   cd C:\path\to\ir-ranking-screening
   ```
3. **åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**  
   ```powershell
   npm install
   ```
4. **ã‚µãƒ³ãƒ—ãƒ«ã§å‹•ä½œç¢ºèª**  
   ```powershell
   npm run survey:sample
   ```
   - å‡ºåŠ› CSV: `output\YYYYMMDDHHMMSS_IRèª¿æŸ»çµæœ_...csv`
   - å®Ÿè¡Œãƒ­ã‚°: `logs\YYYYMMDDHHMMSS_ir-survey.log`
5. **ç‹¬è‡ªãƒªã‚¹ãƒˆã§å®Ÿè¡Œ**  
   `input\` ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã€æ¬¡ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚
   ```powershell
   node src/index.js --mode full --file your_file.csv
   ```

> ğŸ’¡ **Chrome ã‚’æŒ‡å®šã—ãŸã„å ´åˆ**  
> Puppeteer ã¯åŒæ¢± Chromium ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚æ—¢å­˜ã® Google Chrome ã‚’ä½¿ã„ãŸã„å ´åˆã¯ã€ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå‰ã« `PUPPETEER_EXECUTABLE_PATH` ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

## ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰

```bash
npm run survey:full        # 8é …ç›®ã®è©³ç´°èª¿æŸ»
npm run survey:primary     # é …ç›®1-2ï¼ˆä¸€æ¬¡äºˆé¸ï¼‰ã®ã¿
npm run survey:secondary   # é …ç›®3-8ï¼ˆè¿½åŠ èª¿æŸ»ï¼‰ã®ã¿
npm start                  # compactãƒ¢ãƒ¼ãƒ‰ï¼ˆä¸€æ¬¡äºˆé¸ç›¸å½“ã‚µãƒãƒªãƒ¼ï¼‰
node src/index.js --mode compact --file urls_sample.txt --dry-run  # å®Ÿè¡Œå‰ãƒã‚§ãƒƒã‚¯
```

å®Ÿè¡Œå¾Œã€`output/` é…ä¸‹ã« CSV ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ¢ãƒ¼ãƒ‰ã¨å®Ÿè¡Œæ™‚åˆ»ã‚’å«ã‚€å‘½åï¼‰ãŒç”Ÿæˆã•ã‚Œã€åŒæ™‚ã« `logs/` é…ä¸‹ã«å®Ÿè¡Œãƒ­ã‚°ãŒè¿½è¨˜ã•ã‚Œã¾ã™ã€‚

## å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼

å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹ã® `input/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã—ã¦ãã ã•ã„ã€‚ç›¸å¯¾ãƒ‘ã‚¹ã§æŒ‡å®šã—ãŸå ´åˆã¯è‡ªå‹•çš„ã« `input/` åŸºæº–ã§è§£æ±ºã•ã‚Œã¾ã™ã€‚

- **TXT** (æ¨å¥¨)
  ```txt
  https://www.example.com/ir/
  https://www.sample.co.jp/investor/
  ```
- **CSV**ï¼ˆåˆ—æ§‹æˆ: `ä¼æ¥­å,URL` ã¾ãŸã¯ `code,ä¼æ¥­å,URL`ï¼‰
- **JSON**ï¼ˆ`urls` é…åˆ—å†…ã« `{ code, name, url }` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆ—æŒ™ï¼‰

## CLIã‚ªãƒ—ã‚·ãƒ§ãƒ³

```bash
node src/index.js [options]

--file, --file=<path>            å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: urls.txtã€`input/` ã‚’åŸºæº–ã«è§£æ±ºï¼‰
--output, --output=<path>        å‡ºåŠ›å…ˆï¼ˆæœªæŒ‡å®šæ™‚ã¯æ—¥ä»˜+ãƒ¢ãƒ¼ãƒ‰ã§è‡ªå‹•ç”Ÿæˆï¼‰
--wait, --wait=<ms>              è¿½åŠ å¾…æ©Ÿæ™‚é–“ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 3000ï¼‰
--mode, -m <mode>                full / primary / secondary / compact
--output-style <style>           detailed / compactï¼ˆcompact æŒ‡å®šæ™‚ã¯ä¸€æ¬¡äºˆé¸ã«è‡ªå‹•å¤‰æ›ï¼‰
--dry-run                        URLãƒªã‚¹ãƒˆã¨è¨­å®šã®æ¤œè¨¼ã®ã¿ã‚’å®Ÿæ–½ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å‡¦ç†ãªã—ï¼‰
```

## å‡ºåŠ›å½¢å¼

### Detailedï¼ˆfull / primary / secondaryï¼‰

```
å¯¾è±¡URL,èª¿æŸ»é …ç›®,Value,ãƒ’ãƒƒãƒˆã—ãŸURL,æ¤œå‡ºã‚»ãƒ¬ã‚¯ã‚¿,æ¤œå‡ºè¦ç´ ã‚¿ã‚¤ãƒ—
https://example.com/ir/,ã‚µã‚¤ãƒˆå†…æ¤œç´¢ãŒã‚ã‚‹,1,https://example.com/ir/,
https://example.com/ir/,IRè‹±èªç‰ˆã‚µã‚¤ãƒˆãŒã‚ã‚‹,1,https://example.com/en/
...
```

### Compactï¼ˆcompact / legacy Basicï¼‰

```
ã‚³ãƒ¼ãƒ‰,ä¼æ¥­å,URL,å®Ÿéš›ã®URL,ã‚µã‚¤ãƒˆå†…æ¤œç´¢æ©Ÿèƒ½,è‹±èªç‰ˆã‚µã‚¤ãƒˆ,å‚™è€ƒ
1234,ã‚µãƒ³ãƒ—ãƒ«,https://example.com/,https://example.com/,1,1,
```

Compactå½¢å¼ã¯æ—§ Basic ç‰ˆã¨äº’æ›æ€§ã®ã‚ã‚‹ãƒ˜ãƒƒãƒ€ãƒ¼æ§‹æˆã§ã™ã€‚

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`config/keywords.json`ï¼‰

ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚„ã‚»ãƒ¬ã‚¯ã‚¿ã®ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã¯ `config/keywords.json` ã§è¡Œã„ã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¿…é ˆã§ã‚ã‚Šã€å­˜åœ¨ã—ãªã„å ´åˆã¯ CLI ãŒã‚¨ãƒ©ãƒ¼ã§åœæ­¢ã—ã¾ã™ã€‚å¤‰æ›´æ™‚ã¯é¡§å®¢ç’°å¢ƒã¸åæ˜ ã—ã€ãƒªãƒã‚¸ãƒˆãƒªã«ã‚‚ã‚³ãƒŸãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚

ä¸»ãªã‚­ãƒ¼ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

| ã‚­ãƒ¼                  | ä¸»ãªãƒ—ãƒ­ãƒ‘ãƒ†ã‚£                                                                                                                              | ç”¨é€”                           |
| --------------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------ |
| `search`              | `selectors`, `formSelectors`, `iconSelectors`, `modalSelectors`, `triggerTexts`, `specificPatterns`, `hiddenIndicators`, `excludeSelectors` | ã‚µã‚¤ãƒˆå†…æ¤œç´¢UIæ¤œå‡ºã¨èª¤æ¤œå‡ºé™¤å¤– |
| `english`             | `urlPatterns`, `textPatterns`, `excludeDomains`                                                                                             | è‹±èªç‰ˆãƒªãƒ³ã‚¯æ¤œå‡º               |
| `topMessage`          | `textPatterns`, `urlPatterns`, `contentKeywords`, `minContentLength`                                                                        | ç¤¾é•·ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç¢ºèª             |
| `profile`             | `careerKeywords`, `yearPatterns`, `ceoKeywords`                                                                                             | çµŒæ­´æƒ…å ±ç¢ºèª                   |
| `integratedReport`    | `textPatterns`, `reportKeywords`, `pdfIndicators`                                                                                           | çµ±åˆå ±å‘Šæ›¸æ¤œå‡º                 |
| `financial` / `graph` | `textPatterns`, `selectors`, `imageAltKeywords`                                                                                             | è²¡å‹™ã‚°ãƒ©ãƒ•æ¤œå‡º                 |
| `stock`               | `textPatterns`, `urlPatterns`, `contentKeywords`, `excludeUrls`                                                                             | æ ªä¸»é‚„å…ƒãƒ»å„ªå¾…ç¢ºèª             |
| `sustainability`      | `menuKeywords`, `selectors`                                                                                                                 | ã‚µã‚¹ãƒ†ãƒŠãƒ“ãƒªãƒ†ã‚£ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¤œå‡º   |

è¨­å®šä¾‹ï¼š

```json
{
  "search": {
    "triggerTexts": ["æ¤œç´¢", "search", "find"],
    "iconSelectors": [".search-btn", ".search-icon"]
  }
}
```

## ãƒ†ã‚¹ãƒˆ / å“è³ªãƒã‚§ãƒƒã‚¯

```bash
npm run lint           # ESLintï¼ˆ--max-warnings=0ï¼‰
npm run format         # Prettier ãƒã‚§ãƒƒã‚¯
npm test               # Vitestï¼ˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®å˜ä½“ãƒ†ã‚¹ãƒˆï¼‰
npm run smoke          # ã‚µãƒ³ãƒ—ãƒ«URLã«å¯¾ã™ã‚‹dry-run
```

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

```
Error: ENOENT: no such file or directory
```

å¯¾å¿œ: `input/` ã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒé…ç½®ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã€`ls input` ã§å­˜åœ¨ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚çµ¶å¯¾ãƒ‘ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ `--file /absolute/path/to/urls.txt` ã®ã‚ˆã†ã«æŒ‡å®šã§ãã¾ã™ã€‚

```bash
node src/index.js --mode full --file /absolute/path/to/urls.txt
```

### Puppeteer ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã«å¤±æ•—ã™ã‚‹

```
Error: Failed to download Chromium
```

å¯¾å¿œ: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯/ãƒ—ãƒ­ã‚­ã‚·è¨­å®šã‚’è¦‹ç›´ã— `npm install` ã‚’å†å®Ÿè¡Œã€‚Chromium ã‚’æ‰‹å‹•å±•é–‹ã™ã‚‹å ´åˆã¯ `PUPPETEER_SKIP_DOWNLOAD` ã‚’åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚

### å®Ÿè¡ŒãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã™ã‚‹ / è¦ç´ ãŒæ¤œå‡ºã§ããªã„

- `--wait` ã§è¿½åŠ å¾…æ©Ÿæ™‚é–“ã‚’å»¶é•·
- `config/keywords.json` ã® `search.triggerTexts` ã‚„ `search.iconSelectors` ã«å¯¾è±¡ã‚µã‚¤ãƒˆå›ºæœ‰ã®å€¤ã‚’è¿½åŠ 
- `--mode compact` ã§è»½é‡ãƒã‚§ãƒƒã‚¯ã®ã¿è¡Œã„ã€å¯¾è±¡ã‚µã‚¤ãƒˆã®æŒ™å‹•ã‚’ç¢ºèª

---

## ä»˜éŒ²

- `config/keywords.json` ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼ˆ`src/config/keywords.js`ï¼‰ã§å‹•ä½œã—ã¾ã™ãŒã€ç´å“æ™‚ã¯å¿…ãš `keywords.json` ã‚’åŒæ¢±ã—ã¦ãã ã•ã„ã€‚
